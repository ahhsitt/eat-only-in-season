# Feature Specification: UX 问题修复与优化

**Feature Branch**: `006-ux-fixes-optimization`
**Created**: 2026-01-13
**Status**: Draft
**Input**: User description: "仍然有几个问题需要优化：1. 食材点击「了解更多」时接口报错，需去掉了解更多窗口；2. 食材推荐需强调季节性和地方特色，不要全年都有的食材；3. 修复返回按钮参数丢失导致缓存未命中的问题；4. PDF导出需保持页面样式格式完整。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 移除食材详情弹窗功能 (Priority: P1)

用户在首页查看应季食材列表时，不再需要点击「了解更多」来查看食材详情。移除该功能可避免因接口缺少食材名称参数导致的报错，同时简化用户交互流程。

**Why this priority**: 这是一个直接影响用户体验的 bug 修复，用户点击按钮会看到错误信息，必须首先解决。

**Independent Test**: 打开首页，验证食材卡片上不再显示「了解更多」按钮，相关弹窗组件不再被触发。

**Acceptance Scenarios**:

1. **Given** 用户在首页查看应季食材列表, **When** 用户查看任意食材卡片, **Then** 卡片上不显示「了解更多」按钮或类似交互入口
2. **Given** 用户在首页浏览, **When** 用户点击食材卡片任意位置, **Then** 不会弹出食材详情弹窗
3. **Given** 移除详情弹窗功能后, **When** 系统加载首页, **Then** 不会调用食材详情相关接口

---

### User Story 2 - 增强应季食材推荐的季节性与地方特色 (Priority: P1)

用户搜索城市获取应季食材时，系统应优先推荐真正具有季节性的当地特色食材，避免推荐全年都有的普通食材（如鸡蛋、猪肉、牛奶等）。推荐应体现地理特色：沿海城市多推荐海鲜，山区多推荐山珍野味，平原多推荐时令蔬菜等。

**Why this priority**: 这是产品核心价值的体现，直接影响用户对「应季」概念的理解和满意度。

**Independent Test**: 搜索不同地理特征的城市（沿海、内陆、山区），验证推荐食材是否体现地方特色和季节性。

**Acceptance Scenarios**:

1. **Given** 用户搜索沿海城市（如青岛、厦门）, **When** 系统返回应季食材, **Then** 推荐列表中海鲜类食材占比明显，且为当季海鲜
2. **Given** 用户搜索内陆山区城市（如贵阳、昆明）, **When** 系统返回应季食材, **Then** 推荐列表中应包含当地特色山珍和时令蔬菜
3. **Given** 用户在任意城市搜索, **When** 系统返回应季食材, **Then** 推荐列表中不应出现全年供应的常见食材（鸡蛋、猪肉、牛肉、牛奶等）
4. **Given** 用户搜索任意城市, **When** 系统返回应季食材, **Then** 每种食材都应有明确的应季月份说明

---

### User Story 3 - 修复页面返回导航的参数保持 (Priority: P1)

用户在菜谱详情页点击返回按钮时，应正确返回到菜谱列表页，并保持原有的搜索参数（食材列表、偏好、位置），确保缓存命中，避免重新请求数据。

**Why this priority**: 返回导航参数丢失会导致用户体验中断，且造成不必要的接口调用和等待时间。

**Independent Test**: 从首页选择食材 → 进入菜谱列表 → 点击菜谱进入详情 → 点击返回，验证参数保持完整。

**Acceptance Scenarios**:

1. **Given** 用户从菜谱列表（带参数）进入菜谱详情页, **When** 用户点击「返回列表」按钮, **Then** 浏览器 URL 应包含原有的所有查询参数（ingredients, preference, location）
2. **Given** 用户在菜谱详情页点击返回, **When** 页面跳转到菜谱列表, **Then** 列表页应命中缓存，不触发新的 API 请求
3. **Given** 用户从菜谱列表返回首页, **When** 用户点击「返回首页」按钮, **Then** 首页应保持之前选择的城市和食材状态（如果有状态管理）
4. **Given** 用户在任意页面点击返回, **When** 返回到上一页, **Then** 页面状态应与离开前一致

---

### User Story 4 - PDF 导出保持页面样式 (Priority: P2)

用户导出菜谱 PDF 时，生成的文档应尽量保持与网页详情页相似的视觉风格，包括配色、布局结构、字体大小层级等，提供专业美观的导出效果。

**Why this priority**: PDF 导出是增值功能，当前功能可用但样式较简单，优化可提升用户满意度。

**Independent Test**: 在菜谱详情页点击导出 PDF，对比生成的 PDF 与网页样式是否一致。

**Acceptance Scenarios**:

1. **Given** 用户在菜谱详情页, **When** 用户点击「导出 PDF」按钮, **Then** 生成的 PDF 应包含与网页相同的配色方案
2. **Given** 用户导出带图片的菜谱, **When** PDF 生成完成, **Then** 图片应以合适的尺寸和位置显示，与网页布局相似
3. **Given** 用户导出菜谱 PDF, **When** 打开 PDF 文件, **Then** 食材清单、烹饪步骤、小贴士等区块应有清晰的视觉分隔
4. **Given** 用户导出菜谱 PDF, **When** 打开 PDF 文件, **Then** 所有中文内容应正确显示，无乱码

---

### Edge Cases

- 返回导航时原页面已过期或数据已变更，如何处理？（采用缓存优先策略，仍显示缓存数据）
- 导出 PDF 时图片加载失败，如何处理？（继续生成无图版 PDF，不阻断流程）
- 搜索极端地理位置的城市（如南极科考站）时，如何推荐食材？（提示无法获取当地特色食材，建议更换城市）
- 用户快速连续点击返回按钮，如何处理？（防抖处理，避免重复导航）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须移除食材卡片上的「了解更多」按钮及相关交互功能
- **FR-002**: 系统必须移除或禁用食材详情弹窗组件的显示逻辑
- **FR-003**: 系统必须修改食材推荐提示词，明确排除全年供应的常见食材
- **FR-004**: 系统必须在食材推荐提示词中强调根据城市地理特征推荐食材
- **FR-005**: 系统必须确保推荐的食材是合法、安全、可食用的
- **FR-006**: 菜谱详情页的「返回列表」按钮必须携带完整的来源页面参数
- **FR-007**: 菜谱列表页的「返回首页」按钮必须正确导航到首页
- **FR-008**: 所有返回导航必须使用浏览器历史记录或保持查询参数，确保缓存可命中
- **FR-009**: PDF 导出必须使用与网页相似的配色方案（珊瑚橙粉系）
- **FR-010**: PDF 导出必须保持清晰的内容区块划分和视觉层级
- **FR-011**: PDF 导出必须正确处理中文字体渲染

### Key Entities *(include if feature involves data)*

- **食材推荐提示词**: 控制 LLM 生成应季食材的指导性文本，包含地理特征识别、季节性要求、排除规则
- **导航参数**: 页面间传递的状态信息，包括食材列表、用户偏好、地理位置
- **PDF 样式配置**: 控制 PDF 生成的视觉元素，包括颜色、字体大小、间距、布局

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户点击食材卡片后，100% 不再出现「请提供食材名称」错误提示
- **SC-002**: 推荐的应季食材中，95% 以上为具有明确季节性的食材（非全年供应）
- **SC-003**: 沿海城市搜索结果中，海鲜类食材占比不低于 30%
- **SC-004**: 用户从菜谱详情返回列表时，90% 以上的场景能命中缓存（通过日志可验证）
- **SC-005**: 用户从详情页返回列表的操作时间小于 1 秒（缓存命中时）
- **SC-006**: 导出的 PDF 与网页详情页视觉相似度达到用户满意（主观评估：配色一致、布局清晰）
- **SC-007**: PDF 导出成功率保持在 99% 以上

## Assumptions

- 当前食材详情弹窗功能移除后，用户仍可通过食材的简短介绍获得基本信息
- LLM 能够理解并执行更详细的地理特征和季节性要求
- 前端路由框架支持在导航时携带和读取查询参数
- 后端 PDF 生成库支持自定义配色和布局样式
- 用户主要使用现代浏览器，支持浏览器历史记录 API

## Out of Scope

- 新增食材详情展示方式（如展开卡片、侧边栏等）
- 食材推荐的机器学习个性化（基于用户历史）
- PDF 导出的自定义模板选择功能
- 多语言支持
- 离线 PDF 生成功能
